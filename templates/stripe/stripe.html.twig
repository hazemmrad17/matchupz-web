{% extends 'baseM.html.twig' %}

{% block title %}Stripe Payment Gateway{% endblock %}

{% block body %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    {% for message in app.flashes('success') %}
                        <div 
                            style="color: green; border: 2px solid green; text-align: center; padding: 5px; margin-bottom: 10px;">
                            {{ message }}
                        </div>
                    {% endfor %}

                    <form id="checkout-form" method="post" action="{{ path('app_stripe_charge') }}">
                        <input type="hidden" name="stripeToken" id="stripe-token-id">

                        <!-- New Customer Name field -->
                        <div class="mb-3">
                            <label for="customer-name" class="form-label">Customer Name</label>
                            <input type="text" id="customer-name" name="customerName" class="form-control" required>
                        </div>

                        <label for="card-element" class="form-label mb-3">Card Details</label>
                        <div id="card-element" class="form-control mb-4" style="padding: 12px;"></div>

                        <button 
                            id="pay-btn"
                            class="btn btn-success w-100"
                            type="button"
                            onclick="createToken()">
                            PAY $5
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
    const stripe = Stripe("{{ stripe_key }}");
    const elements = stripe.elements();
    const cardElement = elements.create('card');
    cardElement.mount('#card-element');

    function createToken() {
        document.getElementById("pay-btn").disabled = true;

        stripe.createToken(cardElement).then(function(result) {
            if (result.error) {
                document.getElementById("pay-btn").disabled = false;
                alert(result.error.message);
            } else if (result.token) {
                document.getElementById("stripe-token-id").value = result.token.id;
                document.getElementById('checkout-form').submit();
            }
        });
    }
</script>
{% endblock %}
